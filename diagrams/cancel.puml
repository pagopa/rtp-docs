@startuml
' PlantUML Diagram for RTP Deactivation API
' Title: RTP Deactivation Sequence Diagram
' Version: 1.0.0
' Description: This diagram shows the process for a Payer's Service Provider
'              to deactivate the RTP service for an end-user.

!theme materia

title RTP Deactivation API: DELETE /activations/{activationId}

actor "Payer's Service Provider" as PSP
participant "RTP Activation API" as API

autonumber

PSP -> API: DELETE /activations/{activationId}\n(Deactivate RTP for a Payer)
activate API

note right of API
  **Operation:** `deactivate`
  **Description:** A Payer's Service Provider calls this to remove the registration for one of their users.
end note

alt #palegreen Success Case

    API -> API: 1. Validate Request & Security Token
    API -> API: 2. Find the specified activation
    note right of API: Activation found.
    API -> API: 3. Delete activation record from the database
    API --> PSP: **204 No Content**
    note left of PSP
        The deactivation was successful.
        The Payer can no longer receive RTPs.
    end note

else #lightyellow Not Found

    API -> API: 1. Validate Request & Security Token
    API -> API: 2. Find the specified activation
    note right of API: Activation with the given ID does not exist.
    API --> PSP: **404 Not Found**
    note left of PSP
        The specified activation could not be found.
    end note

else #lightcoral Client-Side Errors

    group Authentication / Authorization Errors
        API --> PSP: **401 Unauthorized**\n(e.g., Invalid or expired token)
        API --> PSP: **403 Forbidden**\n(e.g., Insufficient permissions or trying to delete another's activation)
    end group

    group Rate Limiting
        API --> PSP: **429 Too Many Requests**
    end group

else #darkred Server-Side Error

    API -> API: An unexpected internal error occurs
    note right of API: e.g., Database connection failure, unhandled exception.
    API --> PSP: **500 Internal Server Error**

end

deactivate API

@enduml

